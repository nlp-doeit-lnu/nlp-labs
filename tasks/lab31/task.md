# Лабораторна робота №31

## Метод DFA дослідження кореляцій у часових послідовностях із трендами

### Завдання

використовуючи програми +DFA\_1Factory і +DFA\_2Sliding Window, визначити параметри кореляцій для двох часових рядів із найпростішим лінійним трендом, створених програмою +random&trend\_visual (скрипт `random-trend-visual` для `nlp-wine`).

### Порядок виконання роботи

1. Теоретична підготовка до роботи включає вивчення розділу про флуктуації, коротко­сяж­ні й довгосяжні кореляції в ста­тистиці, метод FA (флуктуаційного аналізу) з конс­пек­ту лек­цій, а також ознайомлення з доданими до лабораторної роботи на­уко­вими стат­тя­ми та файлами README всіх програм.
Зокрема, в статті [2] викладено базову теорію та наведено приклади застосування методу детрендованого флуктуаційного аналізу (DFA), стаття [3] містить додаткову інформацію про цей метод, а в додатковій статті [4] подано поглиблений опис деталей DFA для часових рядів із трендами різних типів (синусоїдальних, поліноміальних, степеневих тощо).

2. Ознайомтеся зі змістом файлу «README\_random&trend\_visual.pdf», інтерфейсом і роботою програми +random&trend\_visual, яка генерує та візуалізує часові ряди.
Ці ряди сформовані на­кладанням некорельованого шуму та трендів різних типів.
Тут термін «некорельований» означає, що в шумі відсутні будь-які кореляції і він описується показником кореляційної степені $\gamma = 0.5$.
Проте через наявність тренду коректне значення показника γ не можна знайти за допомогою звичайного методу FA; для цього слід застосувати метод DFA.

3. За допомогою програми +random&trend\_visual згенеруйте два часові ряди зі слабким і сильним лінійним трендом.
Ці ряди умовно позначимо як *series1weak* і *series2strong*.

4. Ознайомтеся зі змістом файлів «README» та інтерфейсами програм +DFA\_1Factory і +DFA\_2Sliding Window (скрипт `DFA_SlidingWindow` для `nlp-java`) і засвойте їхню роботу.
Окрім різних можливостей ро­бо­ти з не­цілочисельними рядами, основна відмінна риса програми +DFA\_2Sliding Window, яка стимулювала її створення,  – це реалізація алгоритму біжучого (або ковзного) вік­на в методі DFA.
Зазначимо, що цей метод зазви­чай базується на роботі із т. зв. «сегментами» часових рядів (тобто з вікнами, які не перекриваються), тоді як в рамках алгоритму біжучого вікна сусідні вікна можуть перекриватися одне з одним.

5. Помістіть файли csv із обома часовими рядами *series1weak* і *series2strong* у деяку порожню папку.
За­пустіть програ­му +DFA\_1Factory.
Вкажіть шлях до цих файлів та оберіть мінімальне вікно $w_{min} = 10–50$ і максимальне вікно $w_{min}$, що дорівнює 10% від довжини часового ряду $L$ (тобто кількості цифр у ньому).
Оскільки раніше ми задали $L = 10000$, то $w_{min} = 1000$.
Оберіть крок зміни ширини біжучого вікна «EXP» від 0.3 до 0.5.
Вкажіть обраний Вами тип сепаратора чисельних даних у файлах csv із часовими рядами, оберіть опцію подвійного проходження «--tw» і найнижчий порядок $l$ DFA: $l = 0$.
Запустіть роботу програми і до­чекайтеся збереження результатів розрахунків.
Випишіть одержані дані $\gamma$ для $l = 0$.

6. Повторіть розрахунки для обох часових рядів *series1weak* і *series2strong* згідно з попереднім пунктом, але для вищих порядків DFA $l$: від $l = 1, 2, 3$.

7. Випишіть у звіт налаштування програми +DFA\_1Factory та значення $\gamma$, одержані для обох часових рядів для всіх порядків $l$.
Проаналізуйте закономірності змін параметрів $\gamma$, які Ви спостерігаєте зі зростанням порядку $l$ DFA-аналізу.
Для яких порядків дані для γ найнадійніші?
Врахуйте, що досліджені часові ряди нескорельовані, тобто шуми в них повинні описуватися показником кореляційної степені $\gamma = 0.5$, який означає від­сутність короткосяжних або довгосяжних кореляцій.

8. Відкрийте файл із часовим рядом *series1weak* програмою +DFA\_2Sliding Window, на­тиснувши на пункт меню «Input file», і активуйте опцію «With “sliding window” algorithm».
Виставте максимальну ширину («End window size») $w_{max}$ біжучого вікна, що при­близно дорівнює 5&ndash;10% від довжини часового ряду $L = 10000$:
$$w_{max} = (0.05\div0.10)L.$$
Далі оберіть мінімальне вікно («Start window size») $w_{min}$, крок розширення вікна «Size delta» і крок переміщення (ковзання) вікна «Shift step» так, аби приблизно дотримувалися рівностей Start window size = Size delta = Shift step, Start window size = End window size / $N$, де $N = 20\div40$.
Оберіть порядок DFA $l = 0$ у полі «DFA(i)».
За рештою параметрів на інтерфейсі за­лиште дефолтні значення.
Натисніть «Analyze», дочекайтеся запов­нен­ня progress bar і вкажіть шлях до зберігання файлу csv звіту програми.
У звіті містяться дані колонок $\Delta F$ і $w$ флуктуаційної залежності $\Delta F(w) \propto w^{\gamma}$, а наприкінці --- значення степеня $\gamma$, знайдене програмою шляхом лінійної апроксимації залежності $\Delta F(w)$ у подвійному логарифмічному масштабі.
Випишіть налаштування програми та значення $\gamma$.

9. Повторіть ті самі дослідження для порядків DFA $l$ = 1, 2 і 3 згідно з попереднім пунктом. 

10. Випишіть у звіт налаштування програми +DFA\_2Sliding Window і значення γ для всіх порядків DFA-аналізу $l = 0\div3$.
Проаналізуйте закономірності змін параметрів $\gamma$, які Ви спостерігаєте зі зростанням порядку $l$ DFA-аналізу часового ряду *series1weak*.
Для яких порядків дані для $\gamma$ виглядають найнадійнішими?
Врахуйте, що досліджений часовий ряд нескорельований, тобто шуми в ньому повинні описуватися показником кореляційної степені $\gamma = 0.5$.

11. Загальні висновки до роботи повинні містити короткий опис зробленого, аналіз і порівняння отриманих коефіцієнтів $\gamma$, їхніх точностей, а також міркування про наявність чи відсутність кореляцій $\gamma$ досліджених часових рядах.

*Додаткові завдання*:

- оцініть точність даних $\gamma$, одержаних за допомогою програми +DFA\_1Factory.
    a. Суто якісне явлення про цю точність можна одержати із графіків флуктуаційних залежностей $\Delta F(w) \propto w^{\gamma}$ у подвійному логарифмічному масштабі (де $\Delta F$ --- це флуктуації, а $w$ – ширина вікна-сегменту).
    Ці графіки відображено в фай­лах \*\*.png, які видає програма.

    b. Можна також знайти кількісні параметри якості апроксимації (коефіцієнти $R$ лінійної кореляції за Пірсоном) і на цій основі одержати повніше уявлення про точність визначення степенів $\gamma$.
    Для цього слід експортувати вихідні файли з даними апроксимації \*\*.csv, які видає програма +DFA\_1Factory, до зовнішньої програми (наприклад, програми Origin), виконати лінійну апроксимацію даних $\Delta F(w)$ у подвійному логарифмічному масштабі та знайти відповідні коефіцієнти $R$ лінійної кореляції за Пірсоном.
